FROM node:10
WORKDIR /app
COPY package.json ./package.json
COPY yarn.lock ./yarn.lock
COPY data-to-code-api/package.json ./data-to-code-api/package.json
COPY data-to-code-api-objects/package.json ./data-to-code-api-objects/package.json
COPY data-to-code-prod-ui/package.json ./data-to-code-prod-ui/package.json
COPY data-to-code-console/package.json ./data-to-code-console/package.json
COPY data-to-code-objects/package.json ./data-to-code-objects/package.json
COPY data-to-code-objects-test/package.json ./data-to-code-objects-test/package.json

RUN yarn install 

COPY . ./
RUN yarn build
RUN yarn build:docker
RUN cp -r ./data-to-code-prod-ui/dist/ ./data-to-code-api/
CMD ["yarn","api"]
EXPOSE 3000
